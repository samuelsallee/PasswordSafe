# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/signIn.ipynb (unless otherwise specified).

__all__ = ['User', 'H', 'signIn']

# Cell
from beartype import beartype
from awsSchema.apigateway import Response, Event
from dataclasses import dataclass
from dataclasses_json import dataclass_json
from copy import deepcopy

# Cell
from src import passwordHelper as PH
from .passwordTable import UserPasswordTable

# Cell
@dataclass_json
@dataclass
class User:
  username: str
  password: str

class H:
  @staticmethod
  def parseInput(event)->User:
    ec = deepcopy(event)
    user = Event.parseDataClass(User, ec)
    return user
  @staticmethod
  def checkPassword(user:User)->bool:
    userPwTable: UserPasswordTable  = next(UserPasswordTable.query(user.username))
    return PH.checkPassword(userPwTable.passwordHash, user.password)

  @staticmethod
  def makeJWT():
    return '1234'




# Cell
def signIn(event, *args):
  user = H.parseInput(event)
  if not H.checkPassword(user):
    return Response.returnError('user or password is wrong')
  return Response.returnSuccess({'token': H.makeJWT()})


